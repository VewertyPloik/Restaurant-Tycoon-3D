<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>3D Restaurant Tycoon - Food on Tables</title>
<style>
  body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: #f0f0f0; }
  #money {
    position: fixed; top: 10px; left: 10px;
    background: rgba(0,0,0,0.6); color: white; padding: 8px 12px; border-radius: 6px;
    font-size: 18px; font-weight: bold;
    user-select: none;
    z-index: 10;
  }
  #instructions {
    position: fixed; bottom: 10px; left: 10px;
    background: rgba(0,0,0,0.6); color: white; padding: 8px 12px; border-radius: 6px;
    font-size: 14px; user-select: none;
    z-index: 10;
  }
  #upgrades {
    position: fixed; top: 50px; left: 10px;
    background: rgba(255,255,255,0.9);
    padding: 10px;
    border-radius: 8px;
    max-width: 160px;
    user-select: none;
    z-index: 10;
  }
  #upgrades button {
    display: block;
    width: 100%;
    margin: 6px 0;
    padding: 10px;
    font-size: 18px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background-color: #0077ff;
    color: white;
    transition: background-color 0.3s ease;
  }
  #upgrades button:disabled {
    background-color: #999;
    cursor: not-allowed;
  }
  .emoji-customer {
    position: absolute;
    font-size: 36px;
    user-select: none;
    pointer-events: none;
    will-change: transform;
  }
  .emoji-food {
    position: absolute;
    font-size: 32px;
    user-select: none;
    pointer-events: none;
    will-change: transform;
  }
</style>
</head>
<body>

<div id="money">Money: $0</div>
<div id="instructions">Watch customers, upgrade food supply!</div>

<div id="upgrades">
  <strong>Upgrade Food Supply</strong>
  <button id="btn-egg">ü•ö Eggs (Start)</button>
  <button id="btn-burger" disabled>üçî Burger ($100)</button>
  <button id="btn-taco" disabled>üåÆ Taco ($300)</button>
  <button id="btn-pizza" disabled>üçï Pizza ($1000)</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

<script>
  (function() {
    // Setup Three.js scene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xa0c8ff);

    const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 10, 20);
    camera.lookAt(0, 0, 0);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Lights
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);

    const dirLight = new THREE.DirectionalLight(0xffffff, 0.5);
    dirLight.position.set(5, 10, 7);
    scene.add(dirLight);

    // Floor (restaurant floor)
    const floorGeo = new THREE.PlaneGeometry(30, 30);
    const floorMat = new THREE.MeshStandardMaterial({color: 0xeeeeee});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI / 2;
    scene.add(floor);

    // Tables (simple boxes)
    const tableGeometry = new THREE.BoxGeometry(3, 0.5, 2);
    const tableMaterial = new THREE.MeshStandardMaterial({color: 0x8b4513});
    const tables = [];

    const tablePositions = [
      [-8, 0.25, -6],
      [-2, 0.25, -6],
      [4, 0.25, -6],
      [-8, 0.25, 0],
      [-2, 0.25, 0],
      [4, 0.25, 0],
    ];

    // For each table, create a div for food emoji
    tablePositions.forEach(pos => {
      const table = new THREE.Mesh(tableGeometry, tableMaterial);
      table.position.set(...pos);
      scene.add(table);
      tables.push({
        mesh: table,
        occupied: false,
        foodEmojiDiv: null, // Will create when customer sits
        foodEmojiVisible: false
      });
    });

    // Chairs around tables (visual only)
    const chairGeo = new THREE.BoxGeometry(0.8, 1, 0.8);
    const chairMat = new THREE.MeshStandardMaterial({color: 0x654321});
    tables.forEach(({mesh}) => {
      const positions = [
        [mesh.position.x - 1.5, 0.5, mesh.position.z - 0.75],
        [mesh.position.x - 1.5, 0.5, mesh.position.z + 0.75],
        [mesh.position.x + 1.5, 0.5, mesh.position.z - 0.75],
        [mesh.position.x + 1.5, 0.5, mesh.position.z + 0.75],
      ];
      positions.forEach(p => {
        const chair = new THREE.Mesh(chairGeo, chairMat);
        chair.position.set(...p);
        scene.add(chair);
      });
    });

    // Customer emoji options
    const customerEmojis = ['üßçüèª‚Äç‚ôÇÔ∏è', 'üßçüèæ‚Äç‚ôÇÔ∏è', 'üßçüèΩ‚Äç‚ôÇÔ∏è', 'üßçüèª‚Äç‚ôÇÔ∏è'];

    // Customers list (each customer has position + emoji div)
    const customers = [];

    // Money system
    let money = 0;
    const moneyDiv = document.getElementById('money');

    // Food types with cost and pay
    const foodTypes = [
      {name: 'Eggs', emoji: 'ü•ö', cost: 0, pay: 5},
      {name: 'Burger', emoji: 'üçî', cost: 100, pay: 15},
      {name: 'Taco', emoji: 'üåÆ', cost: 300, pay: 30},
      {name: 'Pizza', emoji: 'üçï', cost: 1000, pay: 75},
    ];

    let currentFoodIndex = 0; // Start with Eggs

    // Buttons
    const btnEgg = document.getElementById('btn-egg');
    const btnBurger = document.getElementById('btn-burger');
    const btnTaco = document.getElementById('btn-taco');
    const btnPizza = document.getElementById('btn-pizza');

    // Disable egg button (already unlocked)
    btnEgg.disabled = true;

    function updateButtons() {
      btnBurger.disabled = money < foodTypes[1].cost || currentFoodIndex >= 1;
      btnTaco.disabled = money < foodTypes[2].cost || currentFoodIndex >= 2;
      btnPizza.disabled = money < foodTypes[3].cost || currentFoodIndex >= 3;
    }

    btnBurger.addEventListener('click', () => {
      if (money >= foodTypes[1].cost) {
        money -= foodTypes[1].cost;
        currentFoodIndex = 1;
        updateButtons();
        updateMoney();
      }
    });
    btnTaco.addEventListener('click', () => {
      if (money >= foodTypes[2].cost) {
        money -= foodTypes[2].cost;
        currentFoodIndex = 2;
        updateButtons();
        updateMoney();
      }
    });
    btnPizza.addEventListener('click', () => {
      if (money >= foodTypes[3].cost) {
        money -= foodTypes[3].cost;
        currentFoodIndex = 3;
        updateButtons();
        updateMoney();
      }
    });

    function updateMoney() {
      moneyDiv.textContent = `Money: $${money}`;
    }

    // Customer class (emoji overlay + 3D position)
    class Customer {
      constructor() {
        this.pos = new THREE.Vector3(0, 0, 15); // Spawn outside floor, front
        this.state = 'walkingIn'; // walkingIn, goingToTable, sitting, eating, leaving
        this.speed = 2 + Math.random();
        this.targetTable = null;
        this.eatTimer = 0;

        // Choose random emoji for customer
        const emojiChar = customerEmojis[Math.floor(Math.random() * customerEmojis.length)];
        this.emojiDiv = document.createElement('div');
        this.emojiDiv.classList.add('emoji-customer');
        this.emojiDiv.textContent = emojiChar;
        document.body.appendChild(this.emojiDiv);
      }

      update(delta) {
        switch(this.state) {
          case 'walkingIn':
            this.pos.z -= this.speed * delta;
            if (this.pos.z < 7) {
              // Find free table
              const freeTable = tables.find(t => !t.occupied);
              if (freeTable) {
                this.targetTable = freeTable;
                freeTable.occupied = true;

                // Create food emoji div on table if not exists
                if (!freeTable.foodEmojiDiv) {
                  const foodDiv = document.createElement('div');
                  foodDiv.classList.add('emoji-food');
                  document.body.appendChild(foodDiv);
                  freeTable.foodEmojiDiv = foodDiv;
                }
                freeTable.foodEmojiVisible = true;
                freeTable.foodEmojiDiv.textContent = foodTypes[currentFoodIndex].emoji;

                this.state = 'goingToTable';
              } else {
                this.state = 'leaving';
              }
            }
            break;
          case 'goingToTable':
            // Move to table position in front of table
            const targetPos = new THREE.Vector3(this.targetTable.mesh.position.x, this.pos.y, this.targetTable.mesh.position.z + 1.5);
            const dir = targetPos.clone().sub(this.pos);
            if (dir.length() > 0.1) {
              dir.normalize();
              this.pos.add(dir.multiplyScalar(this.speed * delta));
            } else {
              this.state = 'sitting';
              this.eatTimer = 0;
            }
            break;
          case 'sitting':
            this.eatTimer += delta;
            if (this.eatTimer > 5) {
              this.state = 'leaving';
              this.targetTable.occupied = false;

              // Hide food emoji from table
              this.targetTable.foodEmojiVisible = false;
              if(this.targetTable.foodEmojiDiv) {
                this.targetTable.foodEmojiDiv.style.display = 'none';
              }

              money += foodTypes[currentFoodIndex].pay;
              updateMoney();
              updateButtons();
            }
            break;
          case 'leaving':
            this.pos.z += this.speed * delta;
            if (this.pos.z > 16) {
              this.emojiDiv.remove();
              return false; // remove from array
            }
            break;
        }
        return true;
      }

      // Update emoji position on screen
      updateScreenPosition() {
        // Update customer emoji position
        const vector = this.pos.clone();
        vector.y += 1.7; // Raise emoji above floor
        vector.project(camera);
        const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
        const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
        this.emojiDiv.style.transform = `translate(-50%, -50%) translate(${x}px,${y}px)`;

        // Update food emoji position on table if visible
        tables.forEach(table => {
          if (table.foodEmojiVisible && table.foodEmojiDiv) {
            const pos = table.mesh.position.clone();
            pos.y += 1.5; // above table surface
            pos.project(camera);
            const fx = (pos.x * 0.5 + 0.5) * window.innerWidth;
            const fy = (-pos.y * 0.5 + 0.5) * window.innerHeight;
            table.foodEmojiDiv.style.display = 'block';
            table.foodEmojiDiv.style.transform = `translate(-50%, -50%) translate(${fx}px,${fy}px)`;
          }
        });
      }
    }

    // Spawn customers every few seconds
    let spawnTimer = 0;
    const customersList = [];

    function spawnCustomer() {
      customersList.push(new Customer());
    }

    // Animation loop
    const clock = new THREE.Clock();

    function animate() {
      requestAnimationFrame(animate);
      const delta = clock.getDelta();

      spawnTimer += delta;
      if (spawnTimer > 3) {
        spawnCustomer();
        spawnTimer = 0;
      }

      for(let i = customersList.length -1; i >= 0; i--) {
        if (!customersList[i].update(delta)) {
          customersList.splice(i, 1);
        } else {
          customersList[i].updateScreenPosition();
        }
      }

      renderer.render(scene, camera);
    }

    animate();

    // Resize handler
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  })();
</script>

</body>
</html>
